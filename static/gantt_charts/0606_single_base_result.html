<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>机组排班甘特图</title>
  <script src="https://code.highcharts.com/gantt/highcharts-gantt.js"></script>
  <script src="https://code.highcharts.com/gantt/modules/exporting.js"></script>
</head>
<body>

<!-- 关键改动 1: 为容器设置一个固定的最大高度，这就是你的 "可视窗口" -->
<div id="container" style="max-width: 1200px; min-width: 800px; height: 600px; margin: 1em auto;"></div>

<script>
fetch('/static/data/single_base_gantt_chart_data.json')
  .then(response => response.json())
  .then(data => {
    // --- 关键改动 2: 移除之前动态修改容器高度的代码 ---
    // 下面这三行代码需要被删除，因为我们希望容器高度是固定的
    // const rowHeight = 40;
    // const chartPadding = 100;
    // const numCategories = data.yAxisCategories.length;
    // const newHeight = (numCategories * rowHeight) + chartPadding;
    // document.getElementById('container').style.height = newHeight + 'px';

    // --- 水平滚动计算 (不变) ---
    let minDate = Infinity;
    let maxDate = -Infinity;
    data.seriesData.forEach(task => {
      if (task.start < minDate) minDate = task.sltart;
      if (task.end > maxDate) maxDate = task.end;
    });
    const day = 1000 * 60 * 60 * 24;
    const durationDays = Math.ceil((maxDate - minDate) / day);
    const pixelsPerDay = 3;
    const newPlotWidth = durationDays * pixelsPerDay;

    // --- 新增：垂直滚动计算 ---
    // 1. 定义每一行（一个机组人员）在图表上应占用的像素高度
    const rowHeight = 40; // 您可以调整这个值来控制行间距
    
    // 2. 根据机组人员数量计算绘图区需要的最小总高度
    const numCategories = data.yAxisCategories.length;
    const newPlotHeight = numCategories * rowHeight;


    // --- 初始显示范围的时间戳 (不变) ---
    const initialStartDate = Date.UTC(2025, 4, 29);
    const initialVisibleDays = 3;
    const initialEndDate = initialStartDate + initialVisibleDays * day;


    // --- 初始化图表 ---
    Highcharts.ganttChart('container', {
      title: {
        text: '机组排班结果甘特图'
      },
      chart: {
        scrollablePlotArea: {
          minWidth: newPlotWidth,   // 设置绘图区的最小宽度以实现水平滚动
          minHeight: newPlotHeight  // 设置绘图区的最小高度以实现垂直滚动
        },
        events: {
          load: function () {
            this.xAxis[0].setExtremes(initialStartDate, initialEndDate);
          }
        }
      },
      
      xAxis: {
        min: minDate,
        max: maxDate,
        scrollbar: {
            enabled: true
        }
      },

      yAxis: {
        uniqueNames: true,
        categories: data.yAxisCategories,
        // --- 关键改动 3: 为 Y 轴也明确启用滚动条 ---
        scrollbar: {
            enabled: true
        }
      },
      series: [{
        name: '排班任务',
        data: data.seriesData
      }]
    });
  })
  .catch(error => console.error('Error loading or parsing data:', error));
</script>

</body>
</html>